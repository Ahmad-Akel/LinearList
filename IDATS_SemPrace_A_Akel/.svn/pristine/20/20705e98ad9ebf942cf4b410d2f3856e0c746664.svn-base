package perzistence;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.Iterator;
import java.util.Objects;
import kolekce.Seznam;

/**
 *
 * @author Obadah Al Hariri
 */
public final class Perzistence {

    private Perzistence() {
    }

    public static <T> void uloz(String nazevSouboru, Seznam<T> seznam) throws FileNotFoundException, IOException {
        Objects.requireNonNull(seznam);

        try (FileOutputStream fos = new FileOutputStream(nazevSouboru);
                ObjectOutputStream oos = new ObjectOutputStream(fos)) {

            oos.writeInt(seznam.size());

            Iterator<T> it = seznam.iterator();
            while (it.hasNext()) {
                oos.writeObject(it.next());
            }
            oos.close();
            fos.flush();
            fos.close();
        }
    }

    public static <T> Seznam<T> nacti(String nazevSouboru, Seznam<T> seznam) throws IOException {
        try {
            Objects.requireNonNull(seznam);
            try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(nazevSouboru))) {
                seznam.zrus();
                int pocet = ois.readInt();
                for (int i = 0; i < pocet; i++) {
                    seznam.vlozNaKonec((T) ois.readObject());
                }
                ois.close();
            }
        } catch (IOException | ClassNotFoundException e) {
            throw new IOException();
        }
        return seznam;
    }
}
