package gui;

import java.util.function.Consumer;
import java.util.function.Supplier;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.TextField;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.VBox;
import javafx.stage.Modality;
import javafx.stage.Stage;
import javafx.stage.StageStyle;
import prostredky.Traktor;

/**
 *
 * @author Obadah Al Hariri
 */
public class DialogTraktor extends Stage {
    
    private Traktor traktor; // DopravniProstredek
    private boolean edit;
    private Consumer<Traktor> outputOperation;
    
    private TextField spzTextField;
    private TextField hmotnostTextField;
    private TextField rokVyrobyTextField;
    
    public static DialogTraktor factoryDialogOsobniAutomobil(Supplier<Traktor> input, Consumer<Traktor> output) {
        return new DialogTraktor(input, output);
    }
    
    private DialogTraktor(Supplier<Traktor> input, Consumer<Traktor> output) {
        // input
        edit = input != null;
        traktor = (edit) ? input.get() : new Traktor();

        // output
        outputOperation = output;

        // general
        setTitle("Dialog Traktor");
        setWidth(350);
        setHeight(400);
        initStyle(StageStyle.UTILITY);
        initModality(Modality.WINDOW_MODAL);
        setScene(createScene());

        // input
        if (edit) {
            set();
        }
    }
    
    private Scene createScene() {
        VBox root = new VBox();
        root.setAlignment(Pos.CENTER);
        root.setSpacing(20);
        
        GridPane gridPane = new GridPane();
        gridPane.setAlignment(Pos.CENTER);
        gridPane.setPadding(new Insets(10));
        gridPane.setHgap(10);
        gridPane.setVgap(10);
        
        int row = 0;
        
        spzTextField = addRowTextField(gridPane, "SPZ", row++);
        hmotnostTextField = addRowTextField(gridPane, "Hmotnost", row++);
        rokVyrobyTextField = addRowTextField(gridPane, "Rok Vyroby", row++);
        
        Button ulozButton = new Button("Ulož");
        ulozButton.setOnAction(e -> {
            update();
            outputOperation.accept(traktor);
            close();
        });
        gridPane.add(ulozButton, 1, ++row);
        
        root.getChildren().addAll(gridPane);
        
        Scene scene = new Scene(root);
        return scene;
    }
    
    private static TextField addRowTextField(GridPane gridPane, String labelName, int row) {
        gridPane.add(new Label(labelName), 0, row);
        TextField textField = new TextField();
        gridPane.add(textField, 1, row);
        return textField;
    }
    
    private void update() {
        try {
            traktor.setSpz(spzTextField.getText());
            traktor.setHmotnost(Double.valueOf(hmotnostTextField.getText()));
            traktor.setRokVyroby(Integer.valueOf(rokVyrobyTextField.getText()));
        } catch (NumberFormatException e) {
            new Alert(Alert.AlertType.ERROR, "Něco je prázdné").showAndWait();
        }
    }
    
    private void set() {
        spzTextField.setText(traktor.getSpz());
        hmotnostTextField.setText(String.valueOf(traktor.getHmotnost()));
        rokVyrobyTextField.setText(String.valueOf(traktor.getRokVyroby()));
    }
    
}
